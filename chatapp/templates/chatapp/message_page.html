{% extends 'chatapp/base.html' %}

{% block content %}
<div class="chat-container">

    <!-- Header with home button, user info, and profile picture -->
    <div class="chat-header" style="display: flex; align-items: center; justify-content: space-between; padding: 10px; background-color: #673AB7; color: white; border-radius: 10px; margin-bottom: 10px;">
        <a href="{% url 'index' %}" style="text-decoration: none;">
            <button class="home-button" style="background: none; border: none; color: white; cursor: pointer; font-size: 24px;">
                <i class="fas fa-home home-icon"></i> <!-- Home icon -->
            </button>
        </a>
        
        <div class="chat-user-info" style="flex-grow: 1; text-align: center;">
            <div class="chat-username" style="font-size: 18px; font-weight: bold;">{{ friend.username }}</div> <!-- Friend's username -->
        </div>
        <div class="profile-picture">
            <a href="{% url 'view_profile' pk=friend.pk %}" class="profile-picture">
                <img src="{{ friend.profile.profileimg.url|default:'/media/images/defaultimage.jpeg' }}" alt="Profile Picture" class="profile-img" style="width: 50px; height: 50px; border-radius: 50%; overflow: hidden;">
            </a>
        </div>
    </div>

    <!-- Message area with an ID for JavaScript scrolling -->
    <div id="messageArea" class="message-area" style="flex-grow: 1; overflow-y: auto; padding: 10px; border: 1px solid #E1BEE7; border-radius: 10px; background-color: #FFFFFF;">
        {% for message in messages %}
            <div class="message" style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-radius: 10px; margin-bottom: 10px; 
                background-color: {% if message.sender == request.user and not message.is_read %} #BBDEFB {% else %} #F3E5F5 {% endif %};">
                <div class="message-details" style="flex-grow: 1;">
                    <div class="sender-name" style="font-weight: bold; color: #333;">{{ message.sender.username }}</div> <!-- Sender's name -->
                    <div class="message-text" style="font-size: 14px; color: #616161;">{{ message.content }}</div> <!-- Display the actual message content -->
                    <div class="message-timestamp" style="font-size: 12px; color: #999;">
                        {{ message.timestamp|date:"H:i, j M Y" }} <!-- Displaying the timestamp -->
                    </div>
                </div>
            </div>
        {% empty %}
            <p>No messages yet.</p>
        {% endfor %}
    </div>
    
    <!-- Input field and send button -->
    <div class="message-input-container" style="display: flex; align-items: center; padding: 10px; background-color: #F3E5F5; border-top: 1px solid #E1BEE7;">
        <form action="" id="myForm" method="POST" style="flex-grow: 1; display: flex; align-items: center; width: 100%;">
            {% csrf_token %}
            <input type="text" name="content" placeholder="Type your message here..." style="flex-grow: 1; padding: 10px; border: none; border-radius: 5px; margin-right: 10px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);" required>
            <button type="submit" id="Submit" style="background-color: #673AB7; color: white; border: none; border-radius: 5px; padding: 10px; cursor: pointer; transition: background-color 0.3s;">
                <i class="fas fa-paper-plane"></i> <!-- Send icon -->
            </button>
        </form>
    </div>
</div>

<!-- JavaScript for scrolling to the latest message -->
<script>
    // Scroll to the bottom of the message area on page load
    document.addEventListener("DOMContentLoaded", function() {
        var messageArea = document.getElementById('messageArea');
        messageArea.scrollTop = messageArea.scrollHeight;
    });
</script>

{% endblock %}
